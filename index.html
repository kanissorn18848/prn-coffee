<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PRN Coffee Order Form</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="icon" type="image/png" href="favicon PRN coffee.png">
    <style>
        body { font-family: 'Noto Sans', sans-serif; padding: 20px; background: #c6dbef; color: #21224a; }
        .order-card { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); max-width: 450px; margin: auto; }
        .input-group { margin-bottom: 20px; }
        label { display: block; font-weight: 600; margin-bottom: 8px; }
        select, input[type="text"] { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 16px; }
        .radio-group { display: flex; gap: 20px; background: #f9f9f9; padding: 10px; border-radius: 8px; }
        .subheading {
            text-align: center;
            font-size: 0.9em; /* Makes it smaller than the title */
            color: #3c4093;    /* A softer blue color */
            margin-top: -15px; /* Pulls it closer to the main title */
            margin-bottom: 25px;
            font-weight: 400;
        }
        .stock-indicator {
            text-align: center;
            font-weight: 600;
            font-size: 0.9em;
            justify-content: center;
            gap: 8px;
            padding: 10px;
        }
        
        .summary-box { background: #3182bd; color: white; padding: 15px; border-radius: 10px; margin-bottom: 20px; }
        .summary-box h3 { margin-top: 0; font-size: 1.1em; border-bottom: 1px solid #ffffff55; padding-bottom: 5px; }
        .summary-item { display: flex; justify-content: space-between; font-size: 0.9em; margin: 5px 0; }
        .shop-info {
        background: #fdfaf6;
        border-left: 4px solid #6f4e37;
        padding: 15px;
        margin-bottom: 10px;
        border-radius: 4px;
        font-size: 0.9em;
        }
        .hours {color: #4a332d; margin-bottom: 10px;}
        .explanation {margin-bottom: 15px; line-height: 1.4; color: #555;}
        .menu-descriptions {border-top: 1px solid #eee; padding-top: 10px;}
        .desc-item {margin-bottom: 5px; color: #4b3621;}

        .status-container {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        margin-bottom: 20px;
        font-weight: 600;
        font-size: 0.9em;
        }
        .dot {height: 10px; width: 10px; border-radius: 50%; display: inline-block;}
        /* Colors for the status */
        .dot.open { background-color: #4CAF50; box-shadow: 0 0 8px #4CAF50; }
        .dot.closed { background-color: #f44336; box-shadow: 0 0 8px #f44336; }
        .text-closed { color: #f44336; }
        .text-open { color: #4CAF50; }
        
        button { width: 100%; background: #08519c; color: white; border: none; padding: 15px; border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer; transition: 0.3s; }
        button:hover { background: #003468; }
        button:disabled { background: #ccc; cursor: not-allowed; }
        /* Style for the clear button to make it look different from the submit button */
        button[onclick="clearForm()"] {
            background: #dcdcdc;
            color: #333;
            font-size: 14px;
            padding: 10px;
            border: 1px solid #ccc;
        }
        
        button[onclick="clearForm()"]:hover {
            background: #c0c0c0;
        }
        
    </style>
</head>
<body>

<div class="order-card">
    <h2 style="text-align: center;">‚òï PRN Coffee</h2>
    <p class="subheading"><i>Pro re nata</i>&nbsp; (Latin) "as needed"<br>
    PRN coffee - Personalized coffee as needed for you</p>
    <div class="status-container">
        <span id="status-dot" class="dot"></span>
        <span id="status-text">Open for order!</span>
    </div>
    <div class="shop-info">
        <div class="hours">
            <!-- Option 1 // <strong>üïí Tomorrow's Schedule</strong> Library delivery ~ 10.00 am -->
            <strong> Opening this Tuesday! Welcoming the final block of Yr 2</strong>
        </div>
        <p class="explanation">
            Order before 11pm, then enjoy your coffee in class the next day!
            Payment on Delivery. Make sure you're not late to class :)
        </p>
        
        <div class="menu-descriptions">
            <div class="desc-item"><strong>Our Menu</strong></div>
            <div class="desc-item"><strong>üíä Signature Latte :</strong> Sweetened with condensed milk for a smooth finish.</div>
            <div class="desc-item"><strong>üñ§ Dark & Bold <i>(Cortado)</i> :</strong> A strong, straightforward kick for early class.</div>
            <div class="desc-item"><strong>üç≠ Thai-Style <i>(Es Yen)</i> :</strong> A nostalgic, extra-creamy local favorite with a bold kick and deep sweetness.</div>
            <div class="desc-item"><strong>‚òÄÔ∏è Morning Black <i>(Americano)</i> :</strong> Pure caffeine for the early class. Clean, light, and effective. <strong>0% Sweetness option only! Currently finding suitable syrup üçØ</strong></div>
            <div class="desc-item"><strong>üç´ The Dopamine Loop <i>(Mocha)</i> :</strong> Our signature mocha designed for long study sessions.</div>
            <div class="desc-item"><strong>ü•õ Fresh Milk :</strong> Pure, creamy fresh milk. A perfect non-caffeine comfort choice.</div>
        </div>
    </div>
    <div class="stock-indicator">
        <span id="cups-left">Checking stock...</span>
    </div>
    <div class="input-group">
        <label>Customer Name</label>
        <input type="text" id="customer-name" placeholder="Enter your name" oninput="updateSummary()">
    </div>

    <div class="input-group">
        <label>Select Drink</label>
        <select id="menu-item" onchange="updateSummary()">
            <option value="Signature Latte" data-price="30">Signature Latte</option>
            <option value="Dark & Bold" data-price="35">Dark & Bold</option>
            <option value="Thai-Style" data-price="35">Thai-Style</option>
            <option value="Morning Black" data-price="20">Morning Black (0% Sweetness Only!)</option>
            <option value="The Dopamine Loop" data-price="35">The Dopamine Loop</option>
            <option value="Fresh Milk" data-price="20">Fresh Milk</option>
        </select>
    </div>

    <div class="input-group">
        <label>Type</label>
        <div class="radio-group">
            <!-- <label><input type="radio" name="temp" value="Hot" checked onchange="updateSummary()"> Hot (+0‡∏ø)</label> Remove Hot option-->
            <label><input type="radio" name="temp" value="Cold" checked onchange="updateSummary()"> Cold (+5‡∏ø)</label>
        </div>
    </div>

    <div class="input-group">
        <label>Extra Shot?</label>
        <div class="radio-group">
            <label><input type="radio" name="extra" value="No" checked onchange="updateSummary()"> No</label>
            <label><input type="radio" name="extra" value="Yes" onchange="updateSummary()"> Yes (+5‡∏ø)</label>
        </div>
    </div>

    <div class="input-group">
        <label style="display: flex; align-items: center; gap: 6px;">
        Change to Oat Milk? 
        <img src="Oatside logo.svg" alt="Oatside" style="height: 12px; width: auto; border-radius: 0px;">
        </label>
        <div class="radio-group">
            <label><input type="radio" name="oat" value="No" checked onchange="updateSummary()"> No</label>
            <label><input type="radio" name="oat" value="Yes" onchange="updateSummary()"> Yes (+5‡∏ø)</label>
        </div>
    </div>

    <div class="input-group">
        <label>Sweetness Level</label>
        <select id="sweetness" onchange="updateSummary()">
            <option value="100%">Normal Sweet (100%)</option>
            <option value="50%">Less Sweet (50%)</option>
            <option value="25%">Very Less Sweet (25%)</option>
            <option value="0%">No Sugar (0%)</option>
            <option value="125%">Extra Sweet (125%)</option>
        </select>
    </div>

    <div class="input-group">
        <label>Special Instructions</label>
        <input type="text" id="notes" placeholder="Serve at the class etc." oninput="updateSummary()">
    </div>

    <div class="input-group">
        <button type="button" onclick="clearForm()" style="background: #e0e0e0; color: #21224a; margin-bottom: 10px;">Clear Form</button>
    </div>

    <div class="summary-box">
        <h3>Order Summary</h3>
        <div class="summary-item"><span>Drink:</span> <span id="sum-drink">-</span></div>
        <div class="summary-item"><span>Options:</span> <span id="sum-options">-</span></div>
        <div class="summary-item"><span>Extra Shot:</span> <span id="sum-extra">-</span></div>
        <div class="summary-item"><span>Oat Milk:</span> <span id="sum-oat">-</span></div>
        
        <div class="summary-item" style="font-weight: bold; margin-top: 10px; border-top: 1px solid #ffffff55; padding-top: 5px;">
            <span>Total:</span> <span id="sum-total">0‡∏ø</span>
        </div>
    </div>

    <button onclick="submitOrder()" id="submit-btn">Place Order</button>
</div>

<script>
    // SET YOUR STATUS HERE: true = Open, false = Closed
    const isShopOpen = false; 
    function applyBusinessStatus() {
        const dot = document.getElementById('status-dot');
        const text = document.getElementById('status-text');
        const submitBtn = document.getElementById('submit-btn');
        const stockDisplay = document.getElementById('cups-left'); // Get the stock display element
    
        if (isShopOpen) {
            dot.className = 'dot open';
            text.innerText = 'Open for order!';
            text.className = 'text-open';
            submitBtn.disabled = false;
            // checkDailyStock() will handle the button text if it's open
        } else {
            dot.className = 'dot closed';
            text.innerText = 'Shop is closed üôè';
            text.className = 'text-closed';
            submitBtn.disabled = true;
            submitBtn.style.background = '#ccc';
            submitBtn.innerText = 'Orders Currently Disabled';
            stockDisplay.innerText = "We'll be back soon..."; // Show this instead of "Checking..."
    }
}
    async function checkDailyStock() {
        if (!isShopOpen) {
            const display = document.getElementById('cups-left');
            display.innerText = "We'll be back soon...";
            return; // Stop the function here
        }
        const scriptURL = 'https://script.google.com/macros/s/AKfycbxEe7hZVjMtQaDWyfNaQD_IsJGBWX6EvN7tRZWJeDUS9q2HSWMIEiTR-GZvoXWYGzvp-g/exec';
        try {
            const response = await fetch(scriptURL);
            const status = await response.json();
            
            const display = document.getElementById('cups-left');
            const submitBtn = document.getElementById('submit-btn');
    
            if (status.isSoldOut) {
                display.innerText = "‚ùå Sold out for today!";
                submitBtn.disabled = true;
                submitBtn.innerText = "Check back tomorrow";
            } else {
                display.innerText = `‚òï ${status.remaining} cups left for tomorrow`;
            }
        } catch (e) {
            console.log("Could not load stock status");
        }
    }
    
    // Call this when the page loads
    window.onload = function() {
        applyBusinessStatus(); // Your existing function
        checkDailyStock();     // The new stock checker
    };
    function updateSummary() {
        const menu = document.getElementById('menu-item');
        const drinkName = menu.value;
        const basePrice = parseInt(menu.options[menu.selectedIndex].getAttribute('data-price'));
        
        const type = document.querySelector('input[name="temp"]:checked').value;
        const extra = document.querySelector('input[name="extra"]:checked').value;
        const oat = document.querySelector('input[name="oat"]:checked').value;
        const sweetness = document.getElementById('sweetness').value;
        
        // Price Logic
        let finalPrice = basePrice;
        if (type === "Cold") finalPrice += 5;
        if (extra === "Yes") finalPrice += 5;
        if (oat === "Yes") finalPrice += 5; // Add 5‡∏ø for Oat Milk
    
        // Update UI - Each row gets its own data
        document.getElementById('sum-drink').innerText = drinkName;
        document.getElementById('sum-options').innerText = `${type} | Sweetness: ${sweetness}`;
        document.getElementById('sum-extra').innerText = extra;
        document.getElementById('sum-oat').innerText = oat;
        document.getElementById('sum-total').innerText = `${finalPrice} baht`;
        
        return { drinkName, type, extra, oat, finalPrice };
    }

    // Initialize summary on load
    updateSummary();
    function clearForm() {
        document.getElementById('customer-name').value = '';
        document.getElementById('menu-item').selectedIndex = 0;
        document.querySelector('input[name="temp"][value="Cold"]').checked = true;
        document.querySelector('input[name="extra"][value="No"]').checked = true;
        document.getElementById('sweetness').selectedIndex = 0;
        document.getElementById('notes').value = '';
        document.querySelector('input[name="oat"][value="No"]').checked = true;
        
        updateSummary();
    }
    async function submitOrder() {
        const scriptURL = 'https://script.google.com/macros/s/AKfycbxEe7hZVjMtQaDWyfNaQD_IsJGBWX6EvN7tRZWJeDUS9q2HSWMIEiTR-GZvoXWYGzvp-g/exec';
        const name = document.getElementById('customer-name').value;
        const summary = updateSummary(); // Your existing summary logic
    
        if (!name) {
            alert("Please enter your name.");
            return;
        }
    
        // --- NEW: THE FINAL SAFETY CHECK ---
        const btn = document.getElementById('submit-btn');
        btn.innerText = "Verifying order status...";
        btn.disabled = true;
    
        try {
            // Fetch current stock from the sheet right now
            const response = await fetch(scriptURL);
            const status = await response.json();
    
            if (status.isSoldOut) {
                alert("Sorry! Someone just grabbed the last cup. We are now sold out for today.");
                window.location.reload(); // Refresh to show the 'Sold Out' state
                return;
            }
        } catch (e) {
            console.error("Stock check failed, but proceeding anyway.");
            // We let it proceed here just in case your internet blipped
        }
        // --- END OF SAFETY CHECK ---
    
        // If we passed the check, proceed with the actual order
        const data = {
            customer: name,
            menuItem: summary.drinkName,
            type: summary.type,
            extraShot: summary.extra,
            oatMilk: summary.oat,
            sweetness: document.getElementById('sweetness').value,
            notes: document.getElementById('notes').value,
            total: summary.finalPrice + " baht"
        };
    
        btn.innerText = "Finalizing Order...";
    
        fetch(scriptURL, {
            method: 'POST',
            mode: 'no-cors',
            body: JSON.stringify(data)
        }).then(() => {
            alert("Order sent! Thank you, " + name + ". See you tomorrow at the class!");
            window.location.reload();
        }).catch(err => {
            alert("Error sending order. Please try again.");
            btn.disabled = false;
            btn.innerText = "Place Order";
        });
    }
</script>
</body>
</html>
